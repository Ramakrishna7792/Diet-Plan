<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style5.css">
    <title>User Authentication</title>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script src="navbar.js"></script>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div class="form-box login" id="signin">
            <form id="loginForm">
                <h1>Login</h1>
                <div class="input-box">
                    <input type="email" placeholder="Email" id="loginEmail" required>
                    <i class="bx bxs-envelope"></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Password" id="loginPassword" required>
                    <i class="bx bxs-lock-alt"></i>
                </div>
                <div class="forgot-link">
                    <a href="#" id="forgotPasswordLink">Forgot password?</a>
                </div>
                <button type="submit" class="btn" name="signIn">Login</button>
                <!-- <p>or login with social platform</p> -->
                <!-- <div class="social-icons">
                    <a href="#"><i class="bx bxl-google"></i></a>
                    <a href="#"><i class="bx bxl-facebook"></i></a>
                    <a href="#"><i class="bx bxl-github"></i></a>
                    <a href="#"><i class="bx bxl-linkedin"></i></a>
                </div> -->
            </form>
        </div>

        <!-- Registration Form -->
        <div class="form-box register" id="signup">
            <form id="registerForm">
                <h1>Registration</h1>
                <div class="input-box">
                    <input type="text" placeholder="Username" id="registerUsername" required>
                    <i class="bx bxs-user"></i>
                </div>
                <div class="input-box">
                    <input type="email" placeholder="Email" id="registerEmail" required>
                    <i class="bx bxs-envelope"></i>
                </div>
                <div class="input-box">
                    <input type="password" placeholder="Password" id="registerPassword" required>
                    <i class="bx bxs-lock-alt"></i>
                </div>
                <button type="submit" class="btn" name="signUp">Register</button>
                <!-- <p>or register with social platform</p> -->
                <!-- <div class="social-icons">
                    <a href="#"><i class="bx bxl-google"></i></a>
                    <a href="#"><i class="bx bxl-facebook"></i></a>
                    <a href="#"><i class="bx bxl-github"></i></a>
                    <a href="#"><i class="bx bxl-linkedin"></i></a>
                </div> -->
            </form>
        </div>

        <!-- Toggle Panels -->
        <div class="toggle-box">
            <div class="toggle-panel toggle-left">
                <h1>Hello, Welcome!</h1>
                <p>Don't have an account?</p>
                <button class="btn register-btn" id="signUpButton">Register</button>
            </div>
            <div class="toggle-panel toggle-right">
                <h1>Welcome Back!</h1>
                <p>Already have an account?</p>
                <button class="btn login-btn" id="signInButton">Login</button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" style="display: none;">
        <div class="modal-content">
            <h1>Forgot Password</h1>
            <p>Enter your email to reset your password</p>
            <div class="input-box">
                <input type="email" placeholder="Email" id="forgotEmail" required>
                <i class="bx bxs-envelope"></i>
            </div>
            <button id="forgotPasswordSubmit" class="btn">Send Reset Link</button>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" style="display: none;">
        <div class="modal-content">
            <h1>Reset Your Password</h1>
            <p>Enter the token you received and your new password.</p>
            <div class="input-box">
                <input type="text" placeholder="Reset Token" id="resetToken" required>
                <i class="bx bxs-key"></i>
            </div>
            <div class="input-box">
                <input type="password" placeholder="New Password" id="newPassword" required>
                <i class="bx bxs-lock-alt"></i>
            </div>
            <button id="resetPasswordSubmit" class="btn">Reset Password</button>
            
        </div>
    </div>

    <script>
        const container = document.querySelector('.container');
        const registerBtn = document.querySelector('.register-btn');
        const loginBtn = document.querySelector('.login-btn');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const forgotPasswordModal = document.getElementById('forgotPasswordModal');
        const forgotPasswordSubmit = document.getElementById('forgotPasswordSubmit');
        const resetPasswordModal = document.getElementById('resetPasswordModal');
        const resetPasswordSubmit = document.getElementById('resetPasswordSubmit');
        
        // Toggle Form
        registerBtn.addEventListener('click', () => container.classList.add('active'));
        loginBtn.addEventListener('click', () => container.classList.remove('active'));

        // Handle Registration
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            const response = await fetch('http://localhost:3000/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password }),
            });
            const result = await response.json();
            alert(result.message);
        });

        // Handle Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const response = await fetch('http://localhost:3000/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password }),
            });
            const result = await response.json();
            alert(result.message);
            if(result.message == 'Login successful'){
                    window.location.href = `index0.html?email=${encodeURIComponent(email)}`;
            }

            
        });

        // Handle Forgot Password
        forgotPasswordLink.addEventListener('click', () => {
            forgotPasswordModal.style.display = 'block';
        });

        forgotPasswordSubmit.addEventListener('click', async () => {
            const email = document.getElementById('forgotEmail').value;

            const response = await fetch('http://localhost:3000/forgot-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email }),
            });
            const result = await response.json();
            alert(result.message);
            forgotPasswordModal.style.display = 'none';

            // Show reset password modal after email is sent
            resetPasswordModal.style.display = 'block';
        });

        // Handle Reset Password
        resetPasswordSubmit.addEventListener('click', async () => {
            const resetToken = document.getElementById('resetToken').value;
            const newPassword = document.getElementById('newPassword').value;

            const response = await fetch('http://localhost:3000/reset-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ resetToken, newPassword }),
            });
            const result = await response.json();
            alert(result.message);
            resetPasswordModal.style.display = 'none';
        });

        function redirectToRegistration() {
            const email = document.getElementById('email').value; // Get the email value

            if (!email) {
                alert('Email is required!');
                return;
            }

            // Redirect to registration.html with email as a query parameter
            window.location.href = `registerdiet.html?email=${encodeURIComponent(email)}`;
        }

    </script>
</body>
</html>
